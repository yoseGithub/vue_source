{"version":3,"file":"vue.js","sources":["../src/observer/dep.js","../src/observer/array.js","../src/observer/index.js","../src/util.js","../src/observer/schedular.js","../src/observer/watcher.js","../src/util.js","../src/state.js","../src/compiler/parse.js","../src/compiler/generate.js","../src/compiler/index.js","../src/vdom/index.js","../src/vdom/patch.js","../src/lifecycle.js","../src/init.js","../src/render.js","../src/global-api/index.js","../src/index.js"],"sourcesContent":["// dep存在的意义：watcher是为了监听，取值的时候会触发记录\r\nlet id= 0\r\n\r\nclass Dep {\r\n    constructor () {\r\n        this.id = id++\r\n        this.subs = [] // 属性要记住watcher\r\n    }\r\n    // 如果有报错可自行安装babel插件（@babel/plugin-proposal-class-properties），又或者在外部写成 Dep.target = null\r\n    static target = null\r\n    depend () {\r\n        // 让watcher记住dep\r\n        Dep.target.addDep(this) // this为渲染watcher\r\n    }\r\n    addSub (watcher) {\r\n        this.subs.push(watcher)\r\n    }\r\n    notify () {\r\n        this.subs.forEach(watcher => {\r\n            watcher.update()\r\n        })\r\n    }\r\n}\r\n\r\nlet stack = []\r\n\r\nexport function pushTarget (watcher) {\r\n    Dep.target = watcher\r\n    stack.push(watcher) // stack有渲染watcher，也有其他watcher\r\n}\r\n\r\nexport function popTarget () {\r\n    stack.pop() // 栈型结构，第一个为渲染watcher，后面的为其他watcher，watcher使用过就出栈\r\n    Dep.target = stack[stack.length - 1]\r\n}\r\n\r\nexport default Dep"," // 不能直接改写数组原方法，也就是不能直接 Array.prototype.push = fn 直接改写，这样数组原功能也会被覆盖掉\r\n// 需要通过 Object.create(Array.prototype) 来创建一个对象，通过原型链来获取到数组的方法\r\nlet oldArrayMethods = Array.prototype\r\n\r\nexport let arrayMethods = Object.create(Array.prototype)\r\n// 7个会改变原数组的方法，而其他诸如concat slice等都不会改变原数组\r\nlet methods = ['push', 'pop', 'shift', 'unshift', 'splice', 'reverse', 'sort']\r\n\r\n// AOP切片编程\r\nmethods.forEach(method => {\r\n    arrayMethods[method] = function (...args) {\r\n        // 有可能用户新增的数据是对象，也需要进行拦截，比如 vm._data.arr.push({a: 1})\r\n        let inserted\r\n        let ob = this.__ob__\r\n        switch (method) {\r\n            case 'push':\r\n            case 'unshift':\r\n                inserted = args\r\n                break;\r\n            case 'splice': // splice(0, 1, xxx)\r\n                inserted = args.slice(2)\r\n            default: break;\r\n        }\r\n\r\n        // 如果有值则需要使用 observeArray 方法，通过 Observer 中对每一项进行监控时，如果为数组则会在该数组属性上挂上数组遍历方法\r\n        if (inserted) ob.observeArray(inserted)\r\n        ob.dep.notify()\r\n\r\n        // 调用数组原有方法执行\r\n        const result = oldArrayMethods[method].call(this, ...args)\r\n        return result\r\n    }\r\n})\r\n","import { arrayMethods } from './array.js'\r\nimport Dep from './dep.js'\r\n\r\nclass Observer {\r\n    constructor (value) { // value 最初为 data 传入的每一项数据\r\n        // 这一句是为了在 arrayMethods中可以使用 observeArray 方法，如果是数组，则会在数组上挂载一个 Observer 实例\r\n        // 在数组arrayMethods拦截中可以使用 observeArray 来对数组进行观测\r\n        this.dep = new Dep() // 给数组本身和对象本身增加一个dep属性\r\n\r\n        Object.defineProperty(value, '__ob__', {\r\n            value: this,\r\n            enumerable: false, // 不能被枚举，否则会导致死循环\r\n            configurable: false // 不能删除此属性\r\n        })\r\n\r\n        // value可能是对象 也可能是数组，需要分开处理\r\n        if (Array.isArray(value)) {\r\n            // value.__ob__ = this\r\n\r\n            // 数组不用defineProperty来进行代理 性能不好\r\n            // 如果是数组，则将数组原型链指向被劫持后的数组，这样如果是改变数组的方法则会先被劫持，否则通过原型链使用数组方法\r\n            Object.setPrototypeOf(value, arrayMethods)\r\n            this.observeArray(value) // 原有数组中的对象\r\n            // value.__proto__ = arrayMethods // 同上，但这种写法非标准。个人文章：https://www.jianshu.com/p/28a0164b0d63\r\n        } else {\r\n            this.walk(value)\r\n        }\r\n    }\r\n    // 监控数组中是否为对象，如果是则进行劫持\r\n    observeArray (value) {\r\n        for (let i = 0; i < value.length; i++) {\r\n            observe(value[i])\r\n        }\r\n    }\r\n    walk (data) {\r\n        // 将对象中所有的key 重新用 defineProperty定义成响应式的\r\n        Object.keys(data).forEach((key) => {\r\n            defineReactive(data, key, data[key])\r\n        })\r\n    }\r\n}\r\n\r\nfunction dependArray (value) {\r\n    for (let i = 0; i < value.length; i++) {\r\n        let current = value[i]\r\n        current.__ob__ && current.__ob__.dep.depend()\r\n\r\n        if (Array.isArray(current)) {\r\n            dependArray(current) // 递归依赖收集\r\n        }\r\n    }\r\n}\r\n\r\nexport function defineReactive (data, key, value) { // vue2中数据嵌套不要过深，过深浪费性能\r\n    // value可能也是一个对象，需要再次递归\r\n    const childOb = observe(value) // 对结果递归拦截\r\n\r\n    let dep = new Dep() // 每次都会给属性创建一个dep\r\n    Object.defineProperty(data, key, { // 需要给每个属性都添加一个Dep\r\n        get () {\r\n            if (Dep.target) {\r\n                dep.depend() // 让这个属性自己的dep记住这个watcher\r\n\r\n                // childOb可能是对象，也可能是数组\r\n                if (childOb) {\r\n                    childOb.dep.depend()\r\n                    if (Array.isArray(value)) {\r\n                        dependArray(value)\r\n                    }\r\n                }\r\n            }\r\n            return value\r\n        },\r\n        set (newValue) {\r\n            // 值没变化，无需重新设置\r\n            if (newValue === value) return\r\n            observe(newValue) // 如果用户设置的是一个对象，就继续将用户设置的对象变成响应式的\r\n            value = newValue\r\n\r\n            dep.notify() // 通知 dep 中记录的 wathcer 让它去执行\r\n        }\r\n    })\r\n}\r\n\r\nexport function observe (data) {\r\n    if (typeof data !== 'object' || data == null) return\r\n\r\n    if (data.__ob__) return // 如果有__ob__，证明已经被观测了\r\n\r\n    // 通过类来实现对数据的观测，类可以方便拓展，会产生实例\r\n    return new Observer(data)\r\n}","// 因为工具方法不多，所以没像源码那样再建一个文件夹，源码：src\\core\\util，具体看next-tick.js ，这里只说实现原理，不会写那么多兼容\r\nlet callbacks = []\r\n// 由于批处理的时候会执行nextTick，用户也可能会去调用nextTick，会导致重复执行，因此需要将所有调用nextTick的逻辑都先锁上，等到全部处理完再放开\r\nlet waiting = false\r\n\r\nexport const isObject = val => typeof val === 'object' && val !== null\r\n\r\nfunction flushCallbacks () {\r\n    for (let i = 0; i < callbacks.length; i++) {\r\n        let callback = callbacks[i]\r\n        callback()\r\n    }\r\n    waiting = false\r\n    callbacks = []\r\n}\r\n\r\n// 批量处理，第一次开定时器，后续只更新列表，之后执行清空逻辑\r\n// 第一次cb是渲染watcher更新操作（渲染watcher执行的过程是同步的）\r\n// 第二次cb是用户传入的回调\r\nexport function nextTick(cb) {\r\n    callbacks.push(cb)\r\n\r\n    // 1. Promise\r\n    // 2. mutationObserver\r\n    // 3. setImmdiate\r\n    // 4. setTimeout\r\n    // 由于 vue3 已不再考虑兼容性，里面直接用的 Promise，所以这里就不重现了，有兴趣自行看源码\r\n    if (!waiting) {\r\n        waiting = true\r\n        Promise.resolve().then(flushCallbacks) // 多次调用nextTick，只会开启一次Promise\r\n    }\r\n}\r\n\r\n// 没全写，主要是实现合并原理\r\nconst LIFECYCLE_HOOKS = [\r\n    'beforeCreate',\r\n    'created',\r\n    'beforeMount',\r\n    'mounted'\r\n]\r\n\r\nconst strats = {}\r\nLIFECYCLE_HOOKS.forEach(hook => {\r\n    strats[hook] = mergeHook\r\n})\r\n\r\n// 组件合并策略\r\nstrats.components = function (parentVal, childVal) {\r\n    const res = Object.create(parentVal)\r\n    if (childVal) {\r\n        for (let key in childVal) {\r\n            res[key] = childVal[key]\r\n        }\r\n    }\r\n    return res\r\n}\r\n\r\n// 钩子合并策略，数组形式\r\n// 由于调用时最开始传入的options为{}，所以在策略中要么没有，如果有则第一次parentVal为undefined，childVal有值\r\nfunction mergeHook (parentVal, childVal) {\r\n    if (childVal) {\r\n        if (parentVal) {\r\n            // 如果儿子有父亲也有\r\n            return parentVal.concat(childVal)\r\n        } else {\r\n            // 如果儿子有父亲没有\r\n            return [childVal]\r\n        }\r\n    } else {\r\n        return parentVal // 儿子没有直接采用父亲\r\n    }\r\n}\r\n\r\n// 合并策略，属性采用对象合并（Object.assgin规则），生命周期则包装成数组，后面依次执行\r\nexport function mergeOptions (parent, child) {\r\n    const options = {}\r\n    // 如果父亲有儿子也有，应该用儿子替换父亲；如果父亲有值儿子没有，用父亲的\r\n    // {a: 1} {a: 2} => {a: 2}\r\n    // {a: 1} {b: 2} => {a:1, b: 2}\r\n\r\n    // 使用for，主要考虑到深拷贝\r\n    for (let key in parent) {\r\n        mergeField(key)\r\n    }\r\n\r\n    for (let key in child) {\r\n        if (!parent.hasOwnProperty(key)) {\r\n            mergeField(key)\r\n        }\r\n    }\r\n\r\n    // vue这种做法，老是在函数中写函数我也是醉了…\r\n    function mergeField (key) {\r\n        // 策略模式，生命周期合并处理\r\n        if (strats[key]) {\r\n            return options[key] = strats[key](parent[key], child[key]) // 这里相当于调用mergeHook，因为没完全实现（比如components等那些合并策略并没有实现）\r\n        }\r\n    \r\n        // data属性的合并处理\r\n        if (isObject(parent[key]) && isObject(child[key])) {\r\n            options[key] = {...parent[key], ...child[key]}\r\n        } else {\r\n            if (child[key]) { // 如果儿子有值\r\n                options[key] = child[key]\r\n            } else {\r\n                options[key] = parent[key]\r\n            }\r\n        }\r\n    }\r\n\r\n    return options\r\n}\r\n\r\nfunction makeUp (str) {\r\n    const map = {}\r\n\r\n    str.split(',').forEach(tagName => {\r\n        map[tagName] = true\r\n    })\r\n\r\n    return tag => map[tag] || false\r\n}\r\n\r\n// 标签太多，随便写几个，源码里太多了。高阶函数，比起直接使用数组的include判断，用字典空间复杂度为O(1)\r\nexport const isReservedTag = makeUp('a,p,div,ul,li,span,input,button')\r\n","// 调度文件\r\nimport { nextTick } from \"@/util.js\"\r\n\r\n// let watcherIds = new Set() // 源码用的对象，不知道为什么前面 depsId 用 set ，这里去重却用了对象 has\r\nlet has = {}\r\nlet queue = []\r\nlet pending = false\r\n\r\nfunction flushSchedularQueue () {\r\n    for (let i = 0; i < queue.length; i++) {\r\n        let watcher = queue[i]\r\n        watcher.run()\r\n\r\n        if (!watcher.user) {\r\n            watcher.cb()\r\n        }\r\n    }\r\n    // watcherIds.clear()\r\n    has = {}\r\n    queue = []\r\n    pending = false\r\n}\r\n\r\n// 调度更新，同一个watcher只会触发一次 watcher.run()\r\nexport function queueWatcher (watcher) {\r\n    // 更新时对watcher进行去重操作\r\n    const id = watcher.id\r\n    // if (!watcherIds.has(id))\r\n    if (has[id] == null) {\r\n        queue.push(watcher)\r\n        // watcherIds.add(id)\r\n        has[id] = true\r\n\r\n        // 让queue清空，加锁pending，不同 watcher 只触发一次nextTick更新\r\n        if (!pending) {\r\n            pending = true\r\n            nextTick(flushSchedularQueue)\r\n        }\r\n    }\r\n}","// watcher 记住dep是为了计算属性和让用户调用\r\nimport { popTarget, pushTarget } from \"./dep\"\r\nimport { queueWatcher } from \"./schedular\"\r\n\r\nlet id = 0\r\n\r\nclass Watcher {\r\n    constructor (vm, exprOrFn, cb, options={}) {\r\n        this.vm = vm\r\n        this.cb = cb\r\n        this.id = id++ // 不同组件id都不一样\r\n        this.options = options\r\n        this.user = options.user // 用户watcher\r\n        this.lazy = options.lazy // 如果watcher上有lazy属性，说明是一个计算属性\r\n        this.dirty = this.lazy // dirty代表取值时是否执行用户提供的方法，可变\r\n        this.getter = exprOrFn // 调用传入的函数\r\n        this.deps = [] // watcher 里也要记住dep\r\n        this.depsId = new Set()\r\n\r\n        if (typeof exprOrFn === 'function') {\r\n            this.getter = exprOrFn\r\n        } else {\r\n            this.getter = function () { // exprOrFn传递过来的可能是字符串，也可能是函数\r\n                // 当去当前实例上取值时，才会触发依赖收集\r\n                let path = exprOrFn.split('.')\r\n                let obj = vm\r\n                for (let i = 0; i < path.length; i++) {\r\n                    obj = obj[path[i]]\r\n                }\r\n                return obj\r\n            }\r\n        }\r\n\r\n        // 默认会先调用一次get方法，进行取值，将结果保存下来\r\n        // 如果是计算属性，则什么都不做（计算属性默认不执行）\r\n        this.value = this.lazy ? void 0 : this.get()\r\n    }\r\n    // 这个方法中会对属性进行取值操作\r\n    get () {\r\n        pushTarget(this) // Dep.target = watcher\r\n        // data属性取值，触发updateComponent，其中this指向的时vm\r\n        // computed属性取值，会执行绑定的函数，该函数中的this指向的是该watcher，所以this指向会有问题，需要call(this.vm)\r\n        let result = this.getter.call(this.vm)\r\n        popTarget()\r\n\r\n        return result\r\n    }\r\n    // 当属性取值时，需要记住这个watcher，稍后数据变化了，去执行自己记住的watcher即可\r\n    addDep (dep) {\r\n        let id = dep.id\r\n        if (!this.depsId.has(id)) { // dep是非重复的\r\n            this.depsId.add(id)\r\n            this.deps.push(dep)\r\n            dep.addSub(this)\r\n        }\r\n    }\r\n    // 真正触发更新\r\n    run () {\r\n        let newValue = this.get()\r\n        let oldValue = this.value\r\n        this.value = newValue // 将老值更改掉\r\n        if (this.user) {\r\n            this.cb.call(this.vm, newValue, oldValue)\r\n        }\r\n    }\r\n    update () { // 多次更改，合并成一次（防抖）\r\n        if (this.lazy) {\r\n            this.dirty = true\r\n        } else {\r\n            // 这里不要每次都调用get方法，get会重新渲染页面\r\n            queueWatcher(this)\r\n        }\r\n    }\r\n    evaluate () {\r\n        this.value = this.get()\r\n        this.dirty = false // 取过值后标识，标识已经取过值了\r\n    }\r\n    depend () {\r\n        // 计算属性watcher会存储dep，dep会存储watcher\r\n        // 通过watcher找到对应的所有dep，让所有的dep都记住这个渲染watcher\r\n        let i = this.deps.length\r\n        while (i--) {\r\n            this.deps[i].depend()\r\n        }\r\n    }\r\n}\r\n\r\nexport default Watcher","// 因为工具方法不多，所以没像源码那样再建一个文件夹，源码：src\\core\\util，具体看next-tick.js ，这里只说实现原理，不会写那么多兼容\r\nlet callbacks = []\r\n// 由于批处理的时候会执行nextTick，用户也可能会去调用nextTick，会导致重复执行，因此需要将所有调用nextTick的逻辑都先锁上，等到全部处理完再放开\r\nlet waiting = false\r\n\r\nexport const isObject = val => typeof val === 'object' && val !== null\r\n\r\nfunction flushCallbacks () {\r\n    for (let i = 0; i < callbacks.length; i++) {\r\n        let callback = callbacks[i]\r\n        callback()\r\n    }\r\n    waiting = false\r\n    callbacks = []\r\n}\r\n\r\n// 批量处理，第一次开定时器，后续只更新列表，之后执行清空逻辑\r\n// 第一次cb是渲染watcher更新操作（渲染watcher执行的过程是同步的）\r\n// 第二次cb是用户传入的回调\r\nexport function nextTick(cb) {\r\n    callbacks.push(cb)\r\n\r\n    // 1. Promise\r\n    // 2. mutationObserver\r\n    // 3. setImmdiate\r\n    // 4. setTimeout\r\n    // 由于 vue3 已不再考虑兼容性，里面直接用的 Promise，所以这里就不重现了，有兴趣自行看源码\r\n    if (!waiting) {\r\n        waiting = true\r\n        Promise.resolve().then(flushCallbacks) // 多次调用nextTick，只会开启一次Promise\r\n    }\r\n}\r\n\r\n// 没全写，主要是实现合并原理\r\nconst LIFECYCLE_HOOKS = [\r\n    'beforeCreate',\r\n    'created',\r\n    'beforeMount',\r\n    'mounted'\r\n]\r\n\r\nconst strats = {}\r\nLIFECYCLE_HOOKS.forEach(hook => {\r\n    strats[hook] = mergeHook\r\n})\r\n\r\n// 组件合并策略\r\nstrats.components = function (parentVal, childVal) {\r\n    const res = Object.create(parentVal)\r\n    if (childVal) {\r\n        for (let key in childVal) {\r\n            res[key] = childVal[key]\r\n        }\r\n    }\r\n    return res\r\n}\r\n\r\n// 钩子合并策略，数组形式\r\n// 由于调用时最开始传入的options为{}，所以在策略中要么没有，如果有则第一次parentVal为undefined，childVal有值\r\nfunction mergeHook (parentVal, childVal) {\r\n    if (childVal) {\r\n        if (parentVal) {\r\n            // 如果儿子有父亲也有\r\n            return parentVal.concat(childVal)\r\n        } else {\r\n            // 如果儿子有父亲没有\r\n            return [childVal]\r\n        }\r\n    } else {\r\n        return parentVal // 儿子没有直接采用父亲\r\n    }\r\n}\r\n\r\n// 合并策略，属性采用对象合并（Object.assgin规则），生命周期则包装成数组，后面依次执行\r\nexport function mergeOptions (parent, child) {\r\n    const options = {}\r\n    // 如果父亲有儿子也有，应该用儿子替换父亲；如果父亲有值儿子没有，用父亲的\r\n    // {a: 1} {a: 2} => {a: 2}\r\n    // {a: 1} {b: 2} => {a:1, b: 2}\r\n\r\n    // 使用for，主要考虑到深拷贝\r\n    for (let key in parent) {\r\n        mergeField(key)\r\n    }\r\n\r\n    for (let key in child) {\r\n        if (!parent.hasOwnProperty(key)) {\r\n            mergeField(key)\r\n        }\r\n    }\r\n\r\n    // vue这种做法，老是在函数中写函数我也是醉了…\r\n    function mergeField (key) {\r\n        // 策略模式，生命周期合并处理\r\n        if (strats[key]) {\r\n            return options[key] = strats[key](parent[key], child[key]) // 这里相当于调用mergeHook，因为没完全实现（比如components等那些合并策略并没有实现）\r\n        }\r\n    \r\n        // data属性的合并处理\r\n        if (isObject(parent[key]) && isObject(child[key])) {\r\n            options[key] = {...parent[key], ...child[key]}\r\n        } else {\r\n            if (child[key]) { // 如果儿子有值\r\n                options[key] = child[key]\r\n            } else {\r\n                options[key] = parent[key]\r\n            }\r\n        }\r\n    }\r\n\r\n    return options\r\n}\r\n\r\nfunction makeUp (str) {\r\n    const map = {}\r\n\r\n    str.split(',').forEach(tagName => {\r\n        map[tagName] = true\r\n    })\r\n\r\n    return tag => map[tag] || false\r\n}\r\n\r\n// 标签太多，随便写几个，源码里太多了。高阶函数，比起直接使用数组的include判断，用字典空间复杂度为O(1)\r\nexport const isReservedTag = makeUp('a,p,div,ul,li,span,input,button')\r\n","import Dep from './observer/dep'\r\nimport { observe } from './observer/index'\r\nimport Watcher from './observer/watcher'\r\nimport { nextTick } from './util'\r\n\r\n// 初始化状态\r\nexport function initState (vm) {\r\n    // 将所有数据都定义在 vm 属性上，并且后续更改需要触发视图更新\r\n    const opts = vm.$options // 获取用户属性\r\n\r\n    // 加入options中有同名，查看属性的顺序：props -> methods -> data -> computed -> watch\r\n\r\n    // 如果有data属性，初始化数据\r\n    if (opts.data) {\r\n        initData(vm)\r\n    }\r\n\r\n    if (opts.methods) {\r\n        // 数据的初始化\r\n    }\r\n\r\n    if (opts.computed) {\r\n        initComputed(vm)\r\n    }\r\n    \r\n    if (opts.watch) {\r\n        initWatch(vm)\r\n    }\r\n}\r\n\r\n// 数据代理\r\nfunction Proxy (vm, source, key) {\r\n    Object.defineProperty(vm, key, {\r\n        get () {\r\n            return vm[source][key]\r\n        },\r\n        set (newValue) {\r\n            vm[source][key] = newValue\r\n        }\r\n    })\r\n}\r\n\r\n// 初始化数据\r\nfunction initData (vm) {\r\n    // 数据劫持 Object.defineProperty\r\n    let data = vm.$options.data\r\n\r\n    // data 有可能是个对象，也可能是个函数，如果是个函数，获取函数返回值作为对象\r\n    data = vm._data = typeof data === 'function' ? data.call(vm) : data // 这里最开头的data暂时没看出来有什么用\r\n\r\n    // 通过 vm._data 获取劫持后的数据，用户就可以拿到 _data 了\r\n    // 将 _data 中的数据全部放到 vm 上\r\n    for (let key in data) {\r\n        Proxy(vm, '_data', key)\r\n    }\r\n\r\n    // 观测数据\r\n    observe(data)\r\n}\r\n\r\n// 初始化watcher\r\nfunction initWatch (vm) {\r\n    let watch = vm.$options.watch\r\n    for (let key in watch) {\r\n        const handler = watch[key]\r\n\r\n        if (Array.isArray(handler)) {\r\n            handler.forEach(handle => {\r\n                createWatcher(vm, key, handler)\r\n            })\r\n        } else {\r\n            createWatcher(vm, key, handler) // 字符串、对象、函数\r\n        }\r\n    }\r\n}\r\n\r\nfunction createWatcher (vm, exprOrFn, handler, options) { // options 可以用来标识是用户watcher\r\n    if (typeof handler === 'object' && typeof handler !== 'null') {\r\n        options = handler\r\n        handler = handler.handler // 是一个函数\r\n    }\r\n\r\n    if (typeof handler === 'string') {\r\n        handler = vm[handler] // 将实例的方法作为handler\r\n    }\r\n\r\n    return vm.$watch(exprOrFn, handler, options)\r\n}\r\n\r\nexport function stateMixin (Vue) {\r\n    Vue.prototype.$nextTick = function (cb) {\r\n        nextTick(cb)\r\n    }\r\n    Vue.prototype.$watch = function (exprOrFn, cb, options) {\r\n        // 数据应该迎来这个watcher，数据变化后应该让watcher从新执行\r\n        let watcher = new Watcher(this, exprOrFn, cb, {...options, user: true}) // user: true 用于标识是用户写的侦听器，非渲染watcher\r\n        if (options.immediate) {\r\n            cb() // 如果是immediate，则立即执行\r\n        }\r\n    }\r\n}\r\n\r\n// 初始化计算属性\r\nfunction initComputed (vm) {\r\n    let computed = vm.$options.computed\r\n    // 1. 需要有watcher 2. 需要通过defineProperty 3. dirty\r\n    const watchers = vm._computedWatchers = {} // 用来存放计算属性的watcher\r\n\r\n    for (let key in computed) {\r\n        const userDef = computed[key]\r\n        const getter = typeof userDef === 'function' ? userDef : userDef.get\r\n\r\n        watchers[key] = new Watcher(vm, getter, () => {}, {lazy: true})\r\n        defineComputed(vm, key, userDef)\r\n    }\r\n}\r\n\r\nfunction defineComputed (target, key, userDef) {\r\n    const sharedPropertyDefinition = {\r\n        enumerable: true,\r\n        configurable: true,\r\n        get: () => {},\r\n        set: () => {}\r\n    }\r\n\r\n    // 函数式\r\n    if (typeof userDef === 'function') {\r\n        sharedPropertyDefinition.get = createComputedGetter(key) // 通过dirty来控制是否调用userDef\r\n    } else {\r\n        sharedPropertyDefinition.get = createComputedGetter(key) // 需要加缓存\r\n        sharedPropertyDefinition.set = userDef.set\r\n    }\r\n\r\n    Object.defineProperty(target, key, sharedPropertyDefinition)\r\n}\r\n// 用户取值时调用该方法\r\nfunction createComputedGetter (key) {\r\n    return function () { // 高阶函数，每次取值调用该方法\r\n        const watcher = this._computedWatchers[key]\r\n        if (watcher) {\r\n            if (watcher.dirty) { // 判断是否需要执行用户传递的方法，默认肯定是脏的\r\n                watcher.evaluate() // 对当前watcher求值\r\n            }\r\n\r\n            if (Dep.target) {\r\n                watcher.depend()\r\n            }\r\n\r\n            return watcher.value // 默认返回watcher上存的值\r\n        }\r\n    }\r\n}","// 生成AST语法树\r\n// 直接从github上源码搬运过来的正则 https://github.com/vuejs/vue/blob/edf7df0c837557dd3ea8d7b42ad8d4b21858ade0/packages/vue-template-compiler/build.js#L270\r\nconst ncname = '[a-zA-Z_][\\\\w\\\\-\\\\.]*' // 匹配标签名\r\nconst qnameCapture = \"((?:\" + ncname + \"\\\\:)?\" + ncname + \")\" // 匹配带前缀的标签名 <aa:span>，有命名空间的标签\r\nconst startTagOpen = new RegExp((\"^<\" + qnameCapture))\r\nconst endTag = new RegExp((\"^<\\\\/\" + qnameCapture + \"[^>]*>\"))\r\n// 例如 style     =     \"xxx\" 或 style=\"xxx\" 或 style='xxx' 或 style=xxx\r\n// 这里估计版本有更改，如果不需要捕获=号，则改成/^\\s*([^\\s\"'<>\\/=]+)(?:\\s*=\\s*(?:\"([^\"]*)\"+|'([^']*)'+|([^\\s\"'=<>`]+)))?/\r\nconst attribute = /^\\s*([^\\s\"'<>\\/=]+)(?:\\s*(=)\\s*(?:\"([^\"]*)\"+|'([^']*)'+|([^\\s\"'=<>`]+)))?/\r\nconst startTagClose = /^\\s*(\\/?)>/\r\n\r\n// 解析未处理的剩余html（处理完则前进，仅保留尚未处理的html，直到完全处理完）\r\nexport function parseHTML (html) {\r\n    // vue3里面支持多个根元素（外层加了一个空元素），vue2中只有一个根节点\r\n    function createASTElment (tag, attrs) {\r\n        return {\r\n            tag, // 标签\r\n            type: 1, // 元素类型，1为节点，3为文本\r\n            children: [], // 子节点\r\n            attrs, // 属性\r\n            parent: null // 父节点\r\n        }\r\n    }\r\n\r\n    let root = null\r\n    let currentParent // 当前处理的节点\r\n    let stack = [] // 栈\r\n\r\n    // 根据开始标签、结束标签、文本内容，生成AST语法书\r\n    function start (tagName, attrs) {\r\n        let element = createASTElment(tagName, attrs)\r\n        // 创建树根\r\n        if (!root) {\r\n            root = element\r\n        }\r\n        currentParent = element\r\n        stack.push(element)\r\n    }\r\n\r\n    // 栈处理，这里没写异常处理，可以判断标签是否正常闭合，是否有多余标签等\r\n    function end (tagName) {\r\n        let element = stack.pop()\r\n        currentParent = stack[stack.length - 1]\r\n        // 双指针（父子互相记录）\r\n        if (currentParent) {\r\n            element.parent = currentParent\r\n            currentParent.children.push(element)\r\n\r\n        }\r\n    }\r\n\r\n    \r\n    function chars (text) {\r\n        text = text.replace(/\\s/g, '') // 去除空格，源码是更改为一个空格，这里为了好判断直接全部去掉\r\n        if (text) {\r\n            currentParent.children.push({\r\n                type: 3,\r\n                text\r\n            })\r\n        }\r\n    }\r\n\r\n    // 前进，为了减少解析，需要在解析后则删除掉（前进一段）\r\n    function advance (n) {\r\n        html = html.substring(n)\r\n    }\r\n\r\n    // 解析起始标签\r\n    function parseStartTag () {\r\n        const start = html.match(startTagOpen)\r\n        if (start) {\r\n            let match = {\r\n                tagName: start[1],\r\n                attrs: []\r\n            }\r\n\r\n            advance(start[0].length) // 截取至<div\r\n\r\n            // 查找属性\r\n            let end, attr\r\n            // 不是开头标签结尾并且有属性值\r\n            // !(end = html.match(startTagClose) 这里是赋值跟返回放在一起，相当于先赋值end = html.match(startTagClose，再判断end\r\n            while(!(end = html.match(startTagClose)) && (attr = html.match(attribute))) {\r\n                advance(attr[0].length)\r\n\r\n                match.attrs.push({\r\n                    name: attr[1],\r\n                    value: attr[3] || attr[4] || attr[5] || true // 可能是 a=\"1\" a='1' a=1，都没有则为true，比如 disabled 等同于 disabled=\"true\"\r\n                })\r\n            }\r\n\r\n            if (end) {\r\n                advance(end[0].length)\r\n                return match\r\n            }\r\n        }\r\n    }\r\n\r\n    while (html) {\r\n        let textEnd = html.indexOf('<')\r\n        // 匹配的 < 号有可能是开始标签，也可能是结束标签\r\n        if (textEnd === 0) {\r\n            // 开始标签\r\n            let startTagMatch = parseStartTag(html)\r\n            if (startTagMatch) {\r\n                start(startTagMatch.tagName, startTagMatch.attrs)\r\n                continue\r\n            }\r\n            \r\n            // 结束标签，不需要解析获取，只用于前进即可\r\n            let endTagMatch = html.match(endTag)\r\n            if (endTagMatch) {\r\n                advance(endTagMatch[0].length)\r\n                end(endTagMatch[1])\r\n                continue\r\n            }\r\n        }\r\n\r\n        let text\r\n        if (textEnd > 0) { // 开始解析文本(有可能是文本，也可能是标签换行留下的空白)\r\n            text = html.substring(0, textEnd)\r\n        }\r\n\r\n        if (text) {\r\n            advance(text.length)\r\n            chars(text)\r\n        }\r\n    }\r\n\r\n    return root\r\n}","// 匹配出html字符串，根据标签创建输出render字符串函数\r\nconst defaultTagRE = /\\{\\{((?:.|\\r?\\n)+?)\\}\\}/g\r\n\r\nfunction genProps (attrs) {\r\n    let str = ''\r\n    for (let i = 0; i < attrs.length; i++) {\r\n        let attr = attrs[i]\r\n\r\n        // 如果有行内样式，例如 style=\"color: red\"\r\n        if (attr.name === 'style') {\r\n            let obj = {}\r\n            attr.value.split(';').forEach(item => {\r\n                let [key, value] = item.split(':')\r\n                obj[key] = value\r\n            })\r\n            attr.value = obj\r\n        }\r\n\r\n        // 由于字符串拼接，attr.value 会丢失 双引号（或单引号），{id: app}，这样待会解析就变成变量了\r\n        // 所以需要使用JSON.stringify重新将字符串补充上引号 {id: \"app\"}\r\n        str += `${attr.name}: ${JSON.stringify(attr.value)},` // _c('div', {id: \"app\",class: \"wrap\",style: {\"background-color\":\" pink\"}})\r\n    }\r\n\r\n    return `{${str.slice(0, -1)}}` // 去除最后多余的逗号\r\n}\r\n\r\nfunction genChildren(el) {\r\n    const children = el.children\r\n    if (children) {\r\n        return children.map(child => gen(child)).join(',')\r\n    }\r\n}\r\n\r\n// 区分是元素还是文本\r\nfunction gen(node) {\r\n    if (node.type === 1) {\r\n        return generate(node)\r\n    } else {\r\n        // 文本不能用_c来处理\r\n        // 有{{}} 普通文本 混合文本（前两者集合）\r\n        const text = node.text\r\n        // 是鬓语法\r\n        if (defaultTagRE.test(text)) {\r\n            let tokens = [] // 混合文本存放\r\n            let match\r\n            let index = 0\r\n            let lastIndex = defaultTagRE.lastIndex = 0 // lastIndex获取匹配后指针的位置，由于上面用过一次test，所以指针不已经不是0开始了，需要重置为0\r\n\r\n            while(match = defaultTagRE.exec(text)) {\r\n                index = match.index\r\n                if (index > lastIndex) {\r\n                    tokens.push(JSON.stringify(text.slice(lastIndex, index)))\r\n                }\r\n                tokens.push(`_s(${match[1].trim()})`)\r\n                lastIndex = index + match[0].length\r\n            }\r\n\r\n            if (lastIndex < text.length) {\r\n                tokens.push(JSON.stringify(text.slice(lastIndex)))\r\n            }\r\n            return `_v(${tokens.join('+')})`\r\n        } else { // 普通文本\r\n            return `_v(${JSON.stringify(text)})`\r\n        }\r\n    }\r\n}\r\n\r\n// 创建元素\r\nexport function generate (el) {\r\n    let children = genChildren(el)\r\n\r\n    // 转换成render代码，这里看不懂需要先移步去学习相关文档：createElement https://cn.vuejs.org/v2/guide/render-function.html\r\n    // _c('div', {id: \"app\",class: \"wrap\",style: {\"background-color\":\" pink\"}})\r\n    let code = `_c('${el.tag}', ${\r\n        el.attrs.length ? genProps(el.attrs) : 'undefined'\r\n    }${\r\n        children ? ',' + children : ''\r\n    })`\r\n\r\n    return code\r\n}\r\n","// 用于执行 render 字符串\r\nimport { parseHTML } from './parse.js'\r\nimport { generate } from './generate.js'\r\n\r\nexport function compileToFunctions (template) {\r\n    const ast = parseHTML(template)\r\n\r\n    // 源码中还会标记静态节点，转成js语法\r\n    const code = generate(ast) // 生成代码\r\n\r\n    // 不同于eval,with是动态的插入当前的词法作用域，所以可以在外部将Vue传入，这样就能获取到对应的属性\r\n    const render = `with(this){return ${code}}`\r\n    const fn = new Function(render)\r\n    return fn\r\n}\r\n","import { isObject, isReservedTag } from \"@/util.js\"\r\n\r\n// 创建 Dom虚拟节点\r\nexport function createdElement (vm, tag, data = {}, ...children) {\r\n    // 需要对标签名做过滤，因为有可能标签名是一个自定义组件\r\n    if (isReservedTag(tag)) {\r\n        return vnode(vm, tag, data, data.key, children, undefined)\r\n    } else {\r\n        // 自定义组件\r\n        const Ctor = vm.$options.components[tag] // Ctor是个对象或者函数\r\n        // 核心：vue.extend，继承父组件，通过原型链向上查找，封装成函数\r\n        return createComponent(vm, tag, data, data.key, children, Ctor)\r\n    }\r\n}\r\n\r\nfunction createComponent (vm, tag, data, key, children, Ctor) {\r\n    if (isObject(Ctor)) { // 对象，是个子组件，也封装成函数，统一\r\n        Ctor = vm.$options._base.extend(Ctor)\r\n    }\r\n\r\n    // 给组件增加生命周期（源码中是抽离出去的，所以需要将vnode传进入，而不是直接使用Ctor）\r\n    data.hook = {\r\n        init (vnode) {\r\n            // 调用子组件的构造函数，实例化组件\r\n            const child = vnode.componentInstance = new vnode.componentOptions.Ctor({})\r\n            child.$mount() // 手动挂载 vnode.componentInstance.$el = 真实的元素\r\n        }\r\n    }\r\n\r\n    // 组件的虚拟节点拥有 hook 和当前组件的 componentOptions ，Ctor中存放了组件的构造函数\r\n    return vnode(vm, `vue-component-${Ctor.cid}-${tag}`, data, key, undefined, undefined, {Ctor})\r\n}\r\n\r\n// 创建文本虚拟节点\r\nexport function createTextVnode (vm, text) {\r\n    return vnode(vm, undefined, undefined, undefined, undefined, text)\r\n}\r\n\r\nfunction vnode (vm, tag, data, key, children, text, componentOptions) {\r\n    return {\r\n        vm,\r\n        tag,\r\n        children,\r\n        data,\r\n        key,\r\n        text,\r\n        componentOptions\r\n    }\r\n}\r\n\r\n// 是否为相同虚拟节点\r\nexport function isSameVnode (oldVnode, newVnode) {\r\n    return (oldVnode.tag === newVnode.tag) && (oldVnode.key === newVnode.key)\r\n}","import { isSameVnode } from './index.js'\r\n\r\n// 将虚拟节点转换成真实节点，包括初次渲染和diff算法的逻辑\r\nexport function patch(oldVnode, vnode) {\r\n    // 组件没有oldVnode，直接创建元素\r\n    if (!oldVnode) {\r\n        return createElm(vnode) // 根据虚拟节点创建元素\r\n    }\r\n\r\n    // oldVnode 第一次是一个真实的元素，也就是#app\r\n    const isRealElement = oldVnode.nodeType\r\n\r\n    if (isRealElement) {\r\n        // 初次渲染\r\n        const oldElm = oldVnode // id=\"app\"\r\n        const parentElm = oldElm.parentNode // body\r\n        const el = createElm(vnode) // 根据虚拟节点创建真实节点\r\n        // 将创建的节点插入到原有节点的下一个，因为不比vue template，index.html除了入口还可能有其他元素\r\n        parentElm.insertBefore(el, oldElm.nextSibling)\r\n        parentElm.removeChild(oldElm)\r\n        return el // vm.$el\r\n        \r\n    } else {\r\n        // 1. 如果两个虚拟节点的标签不一致，就直接替换掉\r\n        if (oldVnode.tag !== vnode.tag) {\r\n            return oldVnode.el.parentNode.replaceChild(createElm(vnode), oldVnode.el)\r\n        }\r\n\r\n        // 2. 标签一样，但是是两个文本元素（tag: undefined）\r\n        if (!oldVnode.tag) {\r\n            if (oldVnode.text !== vnode.text) {\r\n                oldVnode.el.textContent = vnode.text\r\n            }\r\n        }\r\n\r\n        // 3. 元素相同，属性不同，复用老节点并且更新属性\r\n        let el = vnode.el = oldVnode.el\r\n        // 用老的属性和新的虚拟节点进行比对\r\n        updateProperties(vnode, oldVnode.data)\r\n\r\n        // 4. 更新子元素\r\n        let oldChildren = oldVnode.children || []\r\n        let newChildren = vnode.children || []\r\n\r\n        if (oldChildren.length > 0 && newChildren.length > 0) { // 新的老的都有子元素，需要使用diff算法\r\n            updateChildren(el, oldChildren, newChildren)\r\n        } else if (oldChildren.length > 0) { // 1. 老的有子元素，新的没有子元素，删除老的子元素\r\n            el.innerHTML = '' // 清空所有子节点\r\n        } else if (newChildren.length > 0) { // 2. 新的有子元素，老的没有子元素，在老节点增加子元素即可\r\n            newChildren.forEach(child => el.appendChild(createElm(child)))\r\n        }\r\n    }\r\n}\r\n\r\nfunction updateChildren (parent, oldChildren, newChildren) {\r\n    let oldStartIndex = 0 // 老的父元素起始指针\r\n    let oldEndIndex = oldChildren.length - 1 // 老的父元素终止指针\r\n    let oldStartVnode = oldChildren[0] // 老的开始节点\r\n    let oldEndVnode = oldChildren[oldEndIndex] // 老的结束节点\r\n\r\n    let newStartIndex = 0 // 新的父元素起始指针\r\n    let newEndIndex = newChildren.length - 1 // 新的父元素终止指针\r\n    let newStartVnode = newChildren[0] // 新的开始节点\r\n    let newEndVnode = newChildren[newEndIndex] // 新的结束节点\r\n\r\n    // 创建字典表，用于乱序\r\n    function makeIndexByKey (oldChildren) {\r\n        let map = {}\r\n        oldChildren.forEach((item, index) => {\r\n            map[item.key] = index\r\n        })\r\n        return map\r\n    }\r\n\r\n    let map = makeIndexByKey(oldChildren)\r\n\r\n    // 1. 前端中比较常见的操作有：尾部插入 头部插入 头部移动到尾部 尾部移动到头部 正序和反序\r\n    while (oldStartIndex <= oldEndIndex && newStartIndex <= newEndIndex) {\r\n        if (!oldStartVnode) { // 乱序diff算法中处理过的虚拟节点\r\n            oldStartVnode = oldChildren[++oldStartIndex]\r\n        } else if (!oldEndVnode) { // 乱序diff算法中处理过的虚拟节点\r\n            oldEndVnode = oldChildren[--oldEndIndex]\r\n        } else if (isSameVnode(oldStartVnode, newStartVnode)) { // 向后插入操作，开始的虚拟节点一致\r\n            patch(oldStartVnode, newStartVnode) // 递归比对节点\r\n            oldStartVnode = oldChildren[++oldStartIndex]\r\n            newStartVnode = newChildren[++newStartIndex]\r\n        } else if (isSameVnode(oldEndVnode, newEndVnode)) { // 向前插入，开始的虚拟节点不一致，结束的虚拟节点一致\r\n            patch(oldEndVnode, newEndVnode)\r\n            oldEndVnode = oldChildren[--oldEndIndex]\r\n            newEndVnode = newChildren[--newEndIndex]\r\n        } else if (isSameVnode(oldStartVnode, newEndVnode)) { // 开始结束都不一致，旧的开始与新的结尾一致（头部插入尾部）\r\n            patch(oldStartVnode, newEndVnode)\r\n            parent.insertBefore(oldStartVnode.el, oldEndVnode.el.nextSibling)\r\n            oldStartVnode = oldChildren[++oldStartIndex]\r\n            newEndVnode = newChildren[--newEndIndex]\r\n        } else if (isSameVnode(oldEndVnode, newStartVnode)) { // 开始结束都不一致，旧的结尾与新的起始一致（尾部插入头部）\r\n            patch(oldEndVnode, newStartVnode)\r\n            parent.insertBefore(oldEndVnode.el, oldStartVnode.el)\r\n            oldEndVnode = oldChildren[--oldEndIndex]\r\n            newStartVnode = newChildren[++newStartIndex]\r\n        } else { // 乱序diff算法，检测是否有可复用的key值，有则将原本节点移动，老的位置置为null，否则将新的节点插入进老的节点中来\r\n            // 1. 需要先查找当前索引 老节点索引和key的关系\r\n            // 移动的时候通过新的 key 去找对应的老节点索引 => 获取老节点，可以移动老节点\r\n            let moveIndex = map[newStartVnode.key]\r\n            if (moveIndex === null) { // 不在字典中存在，是个新节点，直接插入\r\n                parent.insertBefore(createElm(newStartVnode), oldStartVnode.el)\r\n            } else {\r\n                let moveVnode = oldChildren[moveIndex]\r\n                oldChildren[moveIndex] = null // 表示该虚拟节点已经处理过，后续递归时可直接跳过\r\n                patch(moveVnode, newStartVnode) // 如果找到了，需要两个虚拟节点对比\r\n                parent.insertBefore(moveVnode.el, oldStartVnode.el)\r\n            }\r\n            newStartVnode = newChildren[++newStartIndex]\r\n        }\r\n    }\r\n\r\n    // 新的比老的多，插入新节点\r\n    if (newStartIndex <= newEndIndex) {\r\n        // 将多出来的节点一个个插入进去\r\n        for (let i = newStartIndex; i <= newEndIndex; i++) {\r\n            // 排查下一个节点是否存在，如果存在证明指针是从后往前（insertBefore），反之指针是从头往后（appendChild）\r\n            let nextEle = newChildren[newEndIndex + 1] === null ? null : newChildren[newEndIndex + 1].el\r\n            // 这里不需要分情况使用 appendChild 或 insertBefore\r\n            // 如果 insertBefore 传入 null，等价于 appendChild\r\n            parent.insertBefore(createElm(newChildren[i]), nextEle)\r\n        }\r\n    }\r\n\r\n    // 老的比新的多，删除老节点\r\n    if (oldStartIndex <= oldEndIndex) {\r\n        for (let i = oldStartIndex; i <= oldEndIndex; i++) {\r\n            let child = oldChildren[i]\r\n            if (child !== null) { // 有可能是遍历到已经被使用过的虚拟节点，需要排除掉\r\n                parent.removeChild(child.el)\r\n            }\r\n        }\r\n    }\r\n}\r\n\r\n// 创建节点真实Dom\r\nfunction createComponent (vnode) {\r\n    let i = vnode.data\r\n    // 先将vnode.data赋值给i，然后将i.hook赋值给i，如果i存在再将i.init赋值给i，疯狂改变i的类型，虽然js中都属于Object，但真的好吗…\r\n    if ((i = i.hook) && (i = i.init)) {\r\n        i(vnode) // 调用组件的初始化方法\r\n    }\r\n\r\n    if (vnode.componentInstance) { // 如果虚拟节点上又组件的实例说明当前这个vnode是组件\r\n        return true\r\n    }\r\n\r\n    return false\r\n}\r\n\r\nexport function createElm (vnode) { // 根据虚拟节点创建真实节点，不同于createElement\r\n    let { vm, tag, data, key, children, text } = vnode    \r\n\r\n    if (typeof tag === 'string') {\r\n        // 可能是组件，如果是组件，就直接创造出组件的真实节点\r\n        if (createComponent(vnode)) {\r\n            // 如果返回true，说明这个虚拟节点是组件\r\n            return vnode.componentInstance.$el\r\n        }\r\n\r\n        vnode.el = document.createElement(tag) // 用vue的指令时，可以通过vnode拿到真实dom\r\n        updateProperties(vnode)\r\n        children.forEach(child => {\r\n            vnode.el.appendChild(createElm(child)) // 递归创建插入节点，现代浏览器appendChild并不会插入一次回流一次\r\n        })\r\n    } else {\r\n        vnode.el = document.createTextNode(text)\r\n    }\r\n\r\n    return vnode.el\r\n}\r\n\r\n// 更新属性，注意这里class与style无法处理表达式，因为从前面解析的时候就没处理，还是那句，重点不在完全实现，而是学习核心思路\r\nfunction updateProperties (vnode, oldProps = {}) {\r\n    const newProps = vnode.data || {}\r\n    const el = vnode.el\r\n\r\n    // 1. 老的属性，新的没有，删除属性\r\n    // 前面提到过一次，以前vue1需要考虑重绘，现在新版浏览器已经会做合并，所以不用再去考虑使用documentFlagment来优化了\r\n    for (let key in oldProps) {\r\n        if (!newProps[key]) {\r\n            el.removeAttribute(key)\r\n        }\r\n    }\r\n\r\n    let newStyle = newProps.style || {}\r\n    let oldStyle = oldProps.style || {}\r\n    for (let key in oldStyle) { // 新老样式先进行比对，删除新vnode中没有的样式\r\n        if (!newStyle[key]) {\r\n            el.style[key] = ''\r\n        }\r\n    }\r\n\r\n    // 2. 新的属性，老的没有，直接用新的覆盖，不用考虑有没有\r\n    for (let key in newProps) {\r\n        if (key === 'style') {\r\n            for (let styleName in newProps.style) {\r\n                el.style[styleName] = newProps.style[styleName]\r\n            }\r\n        } else if (typeof tag === 'class') { // 静态的class可以没有这段，但还是写上，假装如果是class可以处理简单的表达式\r\n            vnode.className = newProps.class\r\n        } else {\r\n            el.setAttribute(key, newProps[key])\r\n        }\r\n    }\r\n}","import Watcher from './observer/watcher.js'\r\nimport { patch } from './vdom/patch.js'\r\n\r\nexport function lifecycleMixin (Vue) {\r\n    // 视图更新方法，用于渲染真实DOM\r\n    Vue.prototype._update = function (vnode) {\r\n        const vm = this\r\n\r\n        const preVnode = vm._vnode // 初始化时必然为undefind\r\n        vm._vnode = vnode\r\n\r\n        if (!preVnode) { // 初渲染\r\n            // 首次渲染，需要用虚拟节点，来更新真实的dom元素（vm._render()）\r\n            // 第一次渲染完毕后 拿到新的节点，下次再次渲染时替换上次渲染的结果\r\n            vm.$el = patch(vm.$el, vnode) // 组件调用patch方法后会产生$el属性\r\n        } else { // 视图更新渲染\r\n            vm.$el = patch(preVnode, vnode)\r\n        }\r\n    }\r\n}\r\n\r\n// 调用合并的生命周期，依次执行\r\nexport function callHook (vm, hook) { // 发布模式\r\n    const handlers = vm.$options[hook]\r\n    if (handlers) {\r\n        handlers.forEach(handlers => handlers.call(vm)) // 这也就是为什么vue的什么周期不能用箭头函数，call将无效，this指向了window而不是vm\r\n    }\r\n}\r\n\r\nexport function mountComponent (vm) {\r\n    let updateComponent = () => {\r\n        vm._update(vm._render()) // vm._render()返回虚拟节点，update返回真实节点\r\n    }\r\n\r\n    // 默认vue是通过watcher来渲染的 渲染watcher（每一个组件都有一个渲染watcher）\r\n    new Watcher(vm, updateComponent, () => {}, true)\r\n}","import { initState, stateMixin } from './state'\r\nimport { compileToFunctions } from './compiler/index.js'\r\nimport { mountComponent, callHook } from './lifecycle.js'\r\nimport { mergeOptions, nextTick } from '@/util'\r\n\r\n// 通过原型混合的方式，往vue的原型添方法\r\nexport function initMixin (Vue) {\r\n    Vue.prototype._init = function (options) { // options是用户传入的对象\r\n        const vm = this\r\n        // 实例上有个属性 $options ，表示的是用户传入的所有属性\r\n        vm.$options = mergeOptions(vm.constructor.options, options)\r\n\r\n        callHook(this, 'beforeCreate')\r\n        // 初始化状态\r\n        initState(vm)\r\n        callHook(this, 'created')\r\n\r\n        // 数据可以挂载到页面上\r\n        if (vm.$options.el) {\r\n            vm.$mount(vm.$options.el)\r\n        }\r\n    }\r\n\r\n    stateMixin(Vue)\r\n    // Vue.prototype.$nextTick = nextTick\r\n\r\n    Vue.prototype.$mount = function (el) {\r\n        el = el && document.querySelector(el) // 自定义组件没有el，但需要挂载\r\n        const vm = this\r\n        const options = vm.$options\r\n        vm.$el = el\r\n\r\n        // 如果有render 就直接使用 render\r\n        // 没有render 看有没有template属性\r\n        // 没有template 就接着找外部模板\r\n        if (!options.render) {\r\n            let template = options.template\r\n            if (!template && el) {\r\n                // 返回内容包含描述元素及其后代的序列化HTML片段，火狐不兼容，可以使用document。createElement('div').appendChild('app').innerHTML来获取\r\n                template = el.outerHTML\r\n            }\r\n            const render = compileToFunctions(template)\r\n            options.render = render // 通过这个步骤，统一为render\r\n        }\r\n\r\n        mountComponent(vm) // 组件挂载\r\n    }\r\n}","import { createdElement, createTextVnode } from './vdom/index.js'\r\n\r\nexport function renderMixin (Vue) {\r\n    // 为什么要写在prototype上？因为render中传入this，也就是只能在vue中的方法和变量才能被获取到\r\n    Vue.prototype._c = function (...args) { // 创建元素虚拟节点\r\n        return createdElement(this, ...args)\r\n    }\r\n\r\n    Vue.prototype._v = function (text) { // 创建元文本拟节点\r\n        return createTextVnode(this, text)\r\n    }\r\n\r\n    Vue.prototype._s = function (value) { // 鬓语法转化成字符串\r\n        // 如果值是个对象，输出成对象字符串，否则输出值\r\n        return value == null ? '' : (typeof value === 'object') ? JSON.stringify(value) : value\r\n    }\r\n\r\n    // 用于执行自定义render方法\r\n    Vue.prototype._render = function () {\r\n        const vm = this\r\n        const render = vm.$options.render // 获取编译后的render方法\r\n\r\n        // 调用render方法产生虚拟节点\r\n        const vnode = render.call(vm) // 调用时会自动将变量进行取值\r\n        return vnode\r\n    }\r\n}","import { mergeOptions } from \"@/util.js\"\r\n\r\nexport function initGlobalAPI (Vue) {\r\n    Vue.options = {} // 用来存储全局的配置\r\n\r\n    // filter directive component\r\n    Vue.mixin = function (mixin) {\r\n        this.options = mergeOptions(this.options, mixin)\r\n        return this\r\n    }\r\n\r\n    // 调用生成组件\r\n    Vue.options._base = Vue // 永远指向Vue的构造函数\r\n    Vue.options.components = {} // 用来存放组件的定义\r\n    Vue.component = function (id, definition) {\r\n        definition.name = definition.name || id // 组件名，如果定义中有name属性则使用name，否则以组件名命名\r\n        definition = this.options._base.extend(definition) // 通过对象产生一个构造函数\r\n        this.options.components[id] = definition\r\n    }\r\n\r\n    let cid = 0\r\n    // 子组件初始化时，会 new VueComponent(options)，产生一个子类Sub\r\n    Vue.extend = function (options) {\r\n        const Super = this // Vue构造函数，此时还未被实例化\r\n        const Sub = function VueComponent (options) {\r\n            this._init(options)\r\n        }\r\n\r\n        Sub.cid = cid++ // 防止组件是同一个构造函数产生的，因为不同组件可能命名却是一样，会导致createComponent中出问题\r\n        Sub.prototype = Object.create(Super.prototype) // 都是通过Vue来继承的\r\n        Sub.prototype.constructor = Sub // 常规操作，原型变更，将实例所指向的原函数也改掉，这样静态属性也会被同步过来\r\n        // 注意这一步不是在替换$options.component，而是在将Vue.component方法进行统一，都是使用的上面那个Vue.component = function (id, definition)函数\r\n        Sub.component = Super.component\r\n        // ...省略其余操作代码\r\n        Sub.options = mergeOptions(Super.options, options) // 将全局组件与该实例化的组件options合并（注意之前的实现，只会合并属性与生命周期）\r\n        return Sub // 这个构造函数是由对象（options）产生而来的\r\n    }\r\n}\r\n","import { initMixin } from './init.js'\r\nimport { lifecycleMixin } from './lifecycle.js'\r\nimport { renderMixin } from './render.js'\r\nimport { initGlobalAPI } from './global-api/index.js'\r\n\r\n// import { compileToFunctions } from './compiler/index.js'\r\n// import { createElm, patch } from './vdom/patch.js'\r\n\r\nfunction Vue (options) {\r\n    this._init(options)\r\n}\r\n\r\ninitMixin(Vue) // 扩展初始化方法\r\nlifecycleMixin(Vue) // 扩展 _updata 方法\r\nrenderMixin(Vue) // 扩展 _render 方法\r\n\r\ninitGlobalAPI(Vue)\r\n\r\n// // 构建两个虚拟Dom\r\n// let vm1 = new Vue({\r\n//     data () {\r\n//         return {\r\n//             name: 'yose'\r\n//         }\r\n//     }\r\n// })\r\n\r\n// let render1 = compileToFunctions(`<ul>\r\n//     <li key=\"A\" style=\"color: #167201\">A</li>\r\n//     <li key=\"B\" style=\"color: #2b4acd\">B</li>\r\n//     <li key=\"C\" style=\"color: #5300c8\">C</li>\r\n//     <li key=\"D\" style=\"color: #f41037\">D</li>\r\n//     <li key=\"F\" style=\"color: #8c6b8a\">F</li>\r\n// </ul>`) // 将模板变为render函数\r\n// let oldVnode = render1.call(vm1) // 老的虚拟节点\r\n// let el = createElm(oldVnode) // 创建真实节点\r\n// document.body.appendChild(el)\r\n\r\n// let vm2 = new Vue({\r\n//     data () {\r\n//         return {\r\n//             name: 'Catherine'\r\n//         }\r\n//     }\r\n// })\r\n\r\n// let render2 = compileToFunctions(`<ul>\r\n//     <li key=\"N\" style=\"color: #6cca8f\">N</li>\r\n//     <li key=\"A\" style=\"color: #167201\">A</li>\r\n//     <li key=\"C\" style=\"color: #5300c8\">C</li>\r\n//     <li key=\"B\" style=\"color: #2b4acd\">B</li>\r\n//     <li key=\"E\" style=\"color: #f41037\">E</li>\r\n// </ul>`) // 将模板变为render函数\r\n// let newVnode = render2.call(vm2) // 老的虚拟节点\r\n\r\n// setTimeout(() => {\r\n//     patch(oldVnode, newVnode)\r\n// }, 2000)\r\n\r\nexport default Vue"],"names":["id","Dep","subs","target","addDep","watcher","push","forEach","update","stack","pushTarget","popTarget","pop","length","oldArrayMethods","Array","prototype","arrayMethods","Object","create","methods","method","inserted","ob","__ob__","args","slice","observeArray","dep","notify","result","call","Observer","value","defineProperty","enumerable","configurable","isArray","setPrototypeOf","walk","i","observe","data","keys","key","defineReactive","dependArray","current","depend","childOb","get","set","newValue","callbacks","waiting","isObject","val","flushCallbacks","callback","nextTick","cb","Promise","resolve","then","LIFECYCLE_HOOKS","strats","hook","mergeHook","components","parentVal","childVal","res","concat","mergeOptions","parent","child","options","mergeField","hasOwnProperty","makeUp","str","map","split","tagName","tag","isReservedTag","has","queue","pending","flushSchedularQueue","run","user","queueWatcher","Watcher","vm","exprOrFn","lazy","dirty","getter","deps","depsId","Set","path","obj","add","addSub","oldValue","initState","opts","$options","initData","computed","initComputed","watch","initWatch","Proxy","source","_data","handler","handle","createWatcher","$watch","stateMixin","Vue","$nextTick","immediate","watchers","_computedWatchers","userDef","defineComputed","sharedPropertyDefinition","createComputedGetter","evaluate","ncname","qnameCapture","startTagOpen","RegExp","endTag","attribute","startTagClose","parseHTML","html","createASTElment","attrs","type","children","root","currentParent","start","element","end","chars","text","replace","advance","n","substring","parseStartTag","match","attr","name","textEnd","indexOf","startTagMatch","endTagMatch","defaultTagRE","genProps","item","JSON","stringify","genChildren","el","gen","join","node","generate","test","tokens","index","lastIndex","exec","trim","code","compileToFunctions","template","ast","render","fn","Function","createdElement","vnode","undefined","Ctor","createComponent","_base","extend","init","componentInstance","componentOptions","$mount","cid","createTextVnode","isSameVnode","oldVnode","newVnode","patch","createElm","isRealElement","nodeType","oldElm","parentElm","parentNode","insertBefore","nextSibling","removeChild","replaceChild","textContent","updateProperties","oldChildren","newChildren","updateChildren","innerHTML","appendChild","oldStartIndex","oldEndIndex","oldStartVnode","oldEndVnode","newStartIndex","newEndIndex","newStartVnode","newEndVnode","makeIndexByKey","moveIndex","moveVnode","nextEle","$el","document","createElement","createTextNode","oldProps","newProps","removeAttribute","newStyle","style","oldStyle","styleName","className","setAttribute","lifecycleMixin","_update","preVnode","_vnode","callHook","handlers","mountComponent","updateComponent","_render","initMixin","_init","constructor","querySelector","outerHTML","renderMixin","_c","_v","_s","initGlobalAPI","mixin","component","definition","Super","Sub","VueComponent"],"mappings":"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"}